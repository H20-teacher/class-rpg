<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì§€ë¸Œë¦¬ ìˆ² êµì‹¤</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Jua', cursive; background: url('https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?q=80&w=2000') no-repeat center center fixed; background-size: cover; margin: 0; padding: 20px; }
        .tab-menu { text-align: center; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; font-size: 1.2rem; cursor: pointer; border-radius: 30px; border: 2px solid #4e7d4e; background: white; color: #4e7d4e; margin: 5px; }
        .tab-btn.active { background: #4e7d4e; color: white; }
        .tab-content { display: none; max-width: 800px; margin: 0 auto; }
        .tab-content.active { display: block; }
        .hub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .hub-item { background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; text-align: center; cursor: pointer; border: 2px solid white; transition: 0.3s; }
        .hub-item:hover { transform: scale(1.02); background: white; }
        .house-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .house-card { background: white; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="tab-menu">
        <button class="tab-btn active" onclick="openTab('plaza')">ğŸ¡ ë§ˆì„ ê´‘ì¥</button>
        <button class="tab-btn" onclick="openTab('village')">ğŸ˜ï¸ ì¹œêµ¬ ë§ˆì´ë£¸ êµ¬ê²½ê°€ê¸°</button>
    </div>

    <div id="plaza" class="tab-content active">
        <div class="hub-grid">
            <div class="hub-item" onclick="accessMyRoom()">ğŸ  ë§ˆì´ë£¸ ê°€ê¸°</div>
            <div class="hub-item" onclick="completeMorningActivity()">â˜€ï¸ ì•„ì¹¨í™œë™ ë ˆë²¨ì—…</div>
            <div class="hub-item" onclick="alert('ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤!')">â˜ï¸ ê°ì •ìƒë‹´ì†Œ</div>
            <div class="hub-item" onclick="alert('ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤!')">ğŸ“– ê³µë¶€ìƒë‹´ì†Œ</div>
        </div>
    </div>

    <div id="village" class="tab-content">
        <div class="house-grid" id="studentGrid"></div>
    </div>

<script>
    let studentData = [];
    // âš ï¸ ì—¬ê¸°ì— ì„ ìƒë‹˜ì˜ ë°°í¬ ì£¼ì†Œë¥¼ ì •í™•íˆ ë„£ì–´ì£¼ì„¸ìš”.
    const scriptURL = "https://script.google.com/macros/s/AKfycbyM2CW5T8ef_2qDc58RnnpJWGYyamyk64twZRZ7xVhmWGDbkdQNgquZQbuAQ0LY_BV4/exec";

    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    async function loadData() {
        try {
            const res = await fetch(scriptURL);
            if (!res.ok) throw new Error('Network response was not ok');
            studentData = await res.json();
            const grid = document.getElementById('studentGrid');
            grid.innerHTML = "";
            studentData.forEach(s => {
                const card = document.createElement('div');
                card.className = 'house-card';
                card.innerHTML = `<h3>${s.name}ì˜ ì§‘</h3><p>Lv.${s.level}</p>`;
                card.onclick = () => openPersonalRoom(s);
                grid.appendChild(card);
            });
        } catch(e) { 
            console.error(e);
            alert("ì‹œíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”!"); 
        }
    }

    function accessMyRoom() {
        if (studentData.length === 0) return alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!");
        const name = prompt("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
        const s = studentData.find(st => st.name === name);
        if (s) {
            const pass = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            if(String(pass) === String(s.passcode)) openPersonalRoom(s);
            else alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        } else alert("ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    async function completeMorningActivity() {
        const name = prompt("ë ˆë²¨ì—…í•  ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
        if (!name) return;
        try {
            const res = await fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify({ action: "addLevel", name: name })
            });
            const result = await res.json();
            if (result.result === "success") {
                alert(`âœ¨ ë ˆë²¨ì—…! í˜„ì¬ ë ˆë²¨: ${result.newLevel}`);
                loadData();
            } else alert(result.message);
        } catch (e) { alert("ì—°ê²° ì‹¤íŒ¨!"); }
    }

    function openPersonalRoom(student) {
        const win = window.open("", "_blank");
        const uploadHTML = `
            <div style="background:#f0f0f0; padding:20px; border-radius:15px; text-align:center; font-family:'Jua';">
                <h2>ğŸƒ ${student.name}ì˜ ë°© (Lv.${student.level})</h2>
                <hr>
                <input type="file" id="fileInput">
                <button onclick="upload()">íŒŒì¼ ë³´ë‚´ê¸°</button>
                <p id="status"></p>
            </div>
            <script>
                async function upload() {
                    const file = document.getElementById('fileInput').files[0];
                    if(!file) return alert('íŒŒì¼ ì„ íƒ!');
                    const reader = new FileReader();
                    reader.onload = async () => {
                        const base64 = reader.result.split(',')[1];
                        const res = await fetch('${scriptURL}', {
                            method: 'POST',
                            body: JSON.stringify({base64: base64, type: file.type, name: '${student.name}_' + file.name})
                        });
                        const result = await res.json();
                        alert(result.result === 'success' ? 'ì œì¶œ ì™„ë£Œ!' : 'ì‹¤íŒ¨');
                    };
                    reader.readAsDataURL(file);
                }
            <\/script>
        `;
        win.document.write(uploadHTML + student.htmlCode.replace(/{{name}}/g, student.name));
        win.document.close();
    }

    loadData();
</script>
<div style="text-align: center; margin-top: 50px; padding-bottom: 20px;">
    <button onclick="document.getElementById('privacyModal').style.display='block'" 
            style="background: none; border: none; color: #666; text-decoration: underline; cursor: pointer; font-size: 0.8rem;">
        ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨
    </button>
</div>

<div id="privacyModal" style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
    <div style="background: white; margin: 10% auto; padding: 20px; width: 80%; max-width: 500px; border-radius: 15px; font-family: sans-serif; line-height: 1.6;">
        <h3 style="margin-top: 0;">ğŸ”’ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</h3>
        <div style="font-size: 0.9rem; color: #333; max-height: 300px; overflow-y: auto; text-align: left;">
            <p><strong>1. ìˆ˜ì§‘ í•­ëª©:</strong> ì„±ëª…(ë˜ëŠ” ë³„ëª…), ë¹„ë°€ë²ˆí˜¸(ì‹ë³„ìš©), ê³¼ì œ íŒŒì¼</p>
            <p><strong>2. ìˆ˜ì§‘ ëª©ì :</strong> í•™ê¸‰ ìš´ì˜ ì‹œìŠ¤í…œ(ë§ˆì´ë£¸) ì ‘ì† ë° í•™ìŠµ ê²°ê³¼ë¬¼(ê³¼ì œ) ê´€ë¦¬</p>
            <p><strong>3. ë³´ìœ  ë° ì´ìš©ê¸°ê°„:</strong> í•´ë‹¹ í•™ë…„ë„ ì¢…ë£Œ ì‹œê¹Œì§€ (ì¢…ë£Œ í›„ êµ¬ê¸€ ì‹œíŠ¸ ë° ë“œë¼ì´ë¸Œ ë°ì´í„° ì¼ê´„ ì‚­ì œ)</p>
            <p><strong>4. ë°ì´í„° ê´€ë¦¬:</strong> ìˆ˜ì§‘ëœ ë°ì´í„°ëŠ” ì™¸ë¶€ ì—…ì²´ì— ì œê³µë˜ì§€ ì•Šìœ¼ë©°, êµì‚¬ì˜ êµ¬ê¸€ ë³´ì•ˆ ê³„ì • ë‚´ì—ì„œë§Œ ê´€ë¦¬ë¨</p>
            <p><strong>5. ë™ì˜ ê±°ë¶€ ê¶Œë¦¬:</strong> ë³¸ ì‹œìŠ¤í…œ ì´ìš©ì„ ì›ì¹˜ ì•Šì„ ê²½ìš° ë³„ë„ì˜ ì˜¤í”„ë¼ì¸ ê³¼ì œ ì œì¶œì´ ê°€ëŠ¥í•¨</p>
        </div>
        <button onclick="document.getElementById('privacyModal').style.display='none'" 
                style="margin-top: 20px; padding: 10px 20px; background: #4e7d4e; color: white; border: none; border-radius: 5px; cursor: pointer;">
            ë‹«ê¸°
        </button>
    </div>
</div>
</body>
</html>





