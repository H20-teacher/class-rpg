<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì§€ë¸Œë¦¬ ìˆ² êµì‹¤</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Jua', cursive; background: url('https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?q=80&w=2000') no-repeat center center fixed; background-size: cover; margin: 0; padding: 20px; }
        .tab-menu { text-align: center; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; font-size: 1.2rem; cursor: pointer; border-radius: 30px; border: 2px solid #4e7d4e; background: white; color: #4e7d4e; margin: 5px; }
        .tab-btn.active { background: #4e7d4e; color: white; }
        .tab-content { display: none; max-width: 800px; margin: 0 auto; }
        .tab-content.active { display: block; }
        .hub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .hub-item { background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; text-align: center; cursor: pointer; border: 2px solid white; }
        .house-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .house-card { background: white; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; }
    </style>
</head>
<body>
    <div class="tab-menu">
        <button class="tab-btn active" onclick="openTab('plaza')">ğŸ¡ ë§ˆì„ ê´‘ì¥</button>
        <button class="tab-btn" onclick="openTab('village')">ğŸ˜ï¸ ì¹œêµ¬ ë§ˆì´ë£¸ êµ¬ê²½ê°€ê¸°</button>
    </div>

    <div id="plaza" class="tab-content active">
        <div class="hub-grid">
            <div class="hub-item" onclick="accessMyRoom()">ğŸ  ë§ˆì´ë£¸ ê°€ê¸°</div>
            <div class="hub-item" onclick="alert('ì•„ì¹¨í™œë™ìœ¼ë¡œ ì´ë™!')">â˜€ï¸ ì•„ì¹¨í™œë™</div>
            <div class="hub-item" onclick="alert('ê°ì •ìƒë‹´ì†Œ!')">â˜ï¸ ê°ì •ìƒë‹´ì†Œ</div>
            <div class="hub-item" onclick="alert('ê³µë¶€ìƒë‹´ì†Œ!')">ğŸ“– ê³µë¶€ìƒë‹´ì†Œ</div>
        </div>
    </div>

    <div id="village" class="tab-content">
        <div class="house-grid" id="studentGrid"></div>
    </div>

<script>
    let studentData = [];
    const scriptURL = "https://script.google.com/macros/s/AKfycbytNu5KjGJAXubBd2fKyxmwq9qi3Dz81DIL5Hej7-USSapr6ReWVMDoDlcH1kutOMzA/exec";

    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    async function loadData() {
        const res = await fetch(scriptURL);
        studentData = await res.json();
        const grid = document.getElementById('studentGrid');
        grid.innerHTML = "";
        studentData.forEach(s => {
            const card = document.createElement('div');
            card.className = 'house-card';
            card.innerHTML = `<h3>${s.name}ì˜ ë°©</h3>`;
            card.onclick = () => openPersonalRoom(s);
            grid.appendChild(card);
        });
    }

    function accessMyRoom() {
        const name = prompt("ì´ë¦„ì´ ë­ì•¼?");
        const s = studentData.find(st => st.name === name);
        if (s && prompt("ë¹„ë°€ë²ˆí˜¸ëŠ”?") === String(s.passcode)) openPersonalRoom(s);
        else alert("ì •ë³´ê°€ ë§ì§€ ì•Šì•„!");
    }

    function openPersonalRoom(student) {
        const win = window.open("", "_blank");
        // íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì„ ëª¨ë“  í•™ìƒ ë°© ìƒë‹¨ì— ê°•ì œë¡œ ë¶™ì—¬ë„£ê¸°
        const uploadHTML = `
            <div style="background:#f0f0f0; padding:20px; border-radius:15px; text-align:center; font-family:'Jua';">
                <h3>ğŸ“¤ ${student.name}ì˜ ê³¼ì œ ì œì¶œí•¨</h3>
                <input type="file" id="fileInput">
                <button onclick="upload()">íŒŒì¼ ë³´ë‚´ê¸°</button>
                <p id="status"></p>
            </div>
            <script>
                async function upload() {
                    const file = document.getElementById('fileInput').files[0];
                    if(!file) return alert('íŒŒì¼ì„ ê³¨ë¼ì¤˜!');
                    document.getElementById('status').innerText = 'ë³´ë‚´ëŠ” ì¤‘...';
                    const reader = new FileReader();
                    reader.onload = async () => {
                        const base64 = reader.result.split(',')[1];
                        const res = await fetch('${https://script.google.com/macros/s/AKfycbxP9vYBqlJ5fZkhXwUeMaEgUMD7nOCy-EIvRMulWMO5zrgj29sWlxheKjt5NhbKekyj/exec}', {
                            method: 'POST',
                            body: JSON.stringify({base64: base64, type: file.type, name: '${student.name}_' + file.name})
                        });
                        const result = await res.json();
                        document.getElementById('status').innerText = result.result === 'success' ? 'ì™„ë£Œ!' : 'ì‹¤íŒ¨ã… ';
                    };
                    reader.readAsDataURL(file);
                }
            <\/script>
        `;
        win.document.write(uploadHTML + student.htmlCode);
        win.document.close();
    }
    loadData();
</script>
</body>
</html>


